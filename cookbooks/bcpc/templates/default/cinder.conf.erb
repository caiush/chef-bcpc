################################################
#
#              Generated by Chef
#
################################################

[DEFAULT]
# XXX: The following is a work-around to allow any cinder process
#      to serve any volume (since they're RBD backed)
host = bcpc
storage_availability_zone=<%=node['bcpc']['region_name']%>
rootwrap_config = /etc/cinder/rootwrap.conf
api_paste_confg = /etc/cinder/api-paste.ini
verbose = False
debug = False
auth_strategy = keystone
state_path = /var/lib/cinder
logdir=/var/log/cinder
# v1 API is being removed in Liberty
enable_v1_api=true
enable_v2_api=true

# Bind to mgt IP only
osapi_volume_listen=<%=node['bcpc']['management']['ip']%>
osapi_volume_workers=1

# If using qpid...
#rpc_backend=cinder.openstack.common.rpc.impl_qpid
#qpid_hostname=<%=node['bcpc']['management']['vip']%>
#qpid_username=admin
#qpid_password=<%=get_config('rabbitmq-password')%>

# Other service endpoints
glance_api_servers=<%=node['bcpc']['protocol']['glance']%>://<%=node['bcpc']['management']['vip']%>:9292
glance_api_insecure=True
glance_api_version=1

# Volume driver settings for RBD
enabled_backends=<%= node['bcpc']['ceph']['enabled_pools'].map {|type| type.upcase}.join(",") %>

# Ceilometer metrics
#control_exchange = cinder
#notification_driver = cinder.openstack.common.notifier.rpc_notifier

[oslo_messaging_rabbit]
# Rabbit message queue settings
#rabbit_host=<%=node['bcpc']['management']['vip']%>
rabbit_hosts=<%=@servers.map{|x| x['bcpc']['management']['ip'] + ":5672"}.shuffle(random: @rabbit_hosts_shuffle_rng).join(',')%>
rabbit_password=<%=get_config('rabbitmq-password')%>
rabbit_ha_queues=True
amqp_durable_queues=True

[oslo_concurrency]
lock_path=/var/lock/cinder

[database]
# MySQL Connection
connection=mysql://<%=get_config('mysql-cinder-user')%>:<%=get_config('mysql-cinder-password')%>@<%=node['bcpc']['management']['vip']%>/<%=node['bcpc']['dbname']['cinder']%>
idle_timeout=3600

[ssl]
ca_file = /etc/ssl/certs/ssl-bcpc.pem

[keystone_authtoken]
cafile = /etc/ssl/certs/ssl-bcpc.pem
auth_uri = <%=node['bcpc']['protocol']['keystone']%>://<%=node['bcpc']['management']['vip']%>:5000/v2.0/
#auth_host = <%=node['bcpc']['management']['vip']%>
#auth_port = 35357
#auth_protocol = <%=node['bcpc']['protocol']['keystone']%>
identity_uri = <%=node['bcpc']['protocol']['keystone']%>://<%=node['bcpc']['management']['vip']%>:35357
auth_version = v2.0
admin_tenant_name = <%=node['bcpc']['admin_tenant']%>
admin_user = <%=get_config('keystone-admin-user')%>
admin_password = <%=get_config('keystone-admin-password')%>
#admin_token = <%=get_config('keystone-admin-token')%>
signing_dir = /var/lib/cinder

<% node['bcpc']['ceph']['enabled_pools'].each do |type| -%>
[<%= type.upcase %>]
volume_driver=cinder.volume.drivers.rbd.RBDDriver
volume_backend_name=<%= type.upcase %>
rbd_user=admin
rbd_pool=<%="#{node['bcpc']['ceph']['volumes']['name']}-#{type}"%>
rbd_secret_uuid=<%=get_config('libvirt-secret-uuid')%>
rbd_flatten_volume_from_snapshot=False
rbd_max_clone_depth=5
<% end -%>
